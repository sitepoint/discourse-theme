{{#if categories}}
  {{! Desktop View }}
  <div class='contents'>
    <table class='topic-list categories--desktop categories'>
      <thead>
        <tr>
          <th class='category'>{{i18n categories.category}}</th>
          <th class='latest'>{{i18n categories.latest}}</th>
          <th class='stats topics'>{{i18n categories.topics}}</th>
          {{#if showPostsColumn}}
          <th class='stats posts'>{{i18n categories.posts}}
            {{#if canOrder}}<button title='{{i18n categories.toggle_ordering}}' class='btn toggle-admin no-text' {{action toggleOrdering}}><i class='fa fa-wrench'></i></button>{{/if}}
          </th>
          {{/if}}
        </tr>
      </thead>
      <tbody>
        {{#each categories}}
        <tr data-category_id='{{unbound id}}' {{bind-attr class="description_excerpt:has-description:no-description logo_url:has-logo:no-logo"}}>

          {{! SP ============================}}
            <td class='category' style='color: #{{unbound color}}'>
          {{! /SP ===========================}}
          
            <div>
              <div class="pull-left category__title">
                {{#if controller.ordering}}<i class="fa fa-bars"></i>{{/if}}

                {{! SP ============================}}
                  {{!category-title-link category=this}}
                  {{category-link this}}
                {{! /SP ===========================}}

                {{#if unreadTopics}}
                  <a href={{unbound unreadUrl}} class='badge new-posts badge-notification' title='{{i18n topic.unread_topics count="unreadTopics"}}'>{{i18n filters.unread.lower_title_with_count count="unreadTopics"}}</a>
                {{/if}}
                {{#if newTopics}}
                  <a href={{unbound newUrl}} class='badge new-posts badge-notification' title='{{i18n topic.new_topics count="newTopics"}}'>{{i18n filters.new.lower_title_with_count count="newTopics"}}</a>
                {{/if}}
              </div>
              <div class="clearfix"></div>
            </div>
            {{#if description_excerpt}}
              <div class="category-description">
                {{{description_excerpt}}}
              </div>
            {{/if}}
            {{#if subcategories}}
              <div class='subcategories'>
                {{#each subcategories}}
                  {{category-link this showParent=true onlyStripe=true}}
                  {{#if unreadTopics}}
                    <a href={{unbound unreadUrl}} class='badge new-posts badge-notification' title='{{i18n topic.unread_topics count="unreadTopics"}}'>{{unbound unreadTopics}}</a>
                  {{/if}}
                  {{#if newTopics}}
                    <a href={{unbound newUrl}} class='badge new-posts badge-notification' title='{{i18n topic.new_topics count="newTopics"}}'>{{unbound newTopics}}</a>
                  {{/if}}
                {{/each}}
              </div>
            {{/if}}
          </td>
          <td {{bind-attr class="archived :latest"}}>
            {{#each featuredTopics}}
              <div class="featured-topic">
                {{topic-status topic=this}}
                <a class='title' href="{{unbound lastUnreadUrl}}">{{{unbound fancy_title}}}</a>
                {{#if totalUnread}}
                  <a href="{{unbound lastUnreadUrl}}" class='badge new-posts badge-notification' title='{{i18n topic.total_unread_posts count="totalUnread"}}'>{{totalUnread}}</a>
                {{/if}}
                {{#if unseen}}
                  <a href="{{unbound lastUnreadUrl}}" class='badge new-posts badge-notification' title='{{i18n topic.new}}'>{{i18n filters.new.lower_title}}</a>
                {{/if}}

                {{#if controller.latestTopicOnly}}
                  <div class='last-user-info'>
                    {{i18n categories.latest_by}} <a href="{{{unbound lastPosterUrl}}}">{{unbound last_poster.username}}</a>
                    <a href="{{unbound lastPostUrl}}">{{age last_posted_at}}</a>
                  </div>
                {{else}}
                  &nbsp;
                  <a href="{{unbound lastPostUrl}}" class="last-posted-at">{{age last_posted_at}}</a>
                {{/if}}
              </div>
            {{/each}}
          </td>
          <td class='stats' {{bind-attr title="topicStatsTitle"}}>
            <table class="categoryStats">
              <tbody>
              {{#each topicCountStats}}
                <tr>
                  <td class="value">{{value}}</td>
                  <td class="unit"> / {{unit}}</td>
                </tr>
              {{/each}}
              </tbody>
            </table>
          </td>
          {{#if controller.showPostsColumn}}
            <td class='stats' {{bind-attr title="postStatsTitle"}}>
              <table class="categoryStats">
                <tbody>
                {{#each postCountStats}}
                  <tr>
                    <td class="value">{{value}}</td>
                    <td class="unit"> / {{unit}}</td>
                  </tr>
                {{/each}}
                </tbody>
              </table>
            </td>
          {{/if}}
        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
  <footer class='topic-list-bottom'></footer>

  {{! Mobile View }}
  {{#each categories}}
    <div class='categories--mobile category-list-item'>
      <table class='topic-list'>
        <tr>
          <th class="main-link">
            {{category-link this allowUncategorized=true}}
          </th>
          <th class='num posts'>{{i18n posts}}</th>
          <th class='num age'>{{i18n age}}</th>
        </tr>

        {{#if description_excerpt}}
          <tr class="category-description">
            <td colspan="3">
              {{{description_excerpt}}}
            </td>
          </tr>
        {{/if}}

        {{#each topics}}
          <tr {{bind-attr class="archived"}}>
            <td class='main-link'>
              <div class='topic-inset'>
                {{topic-status topic=this}}
                {{{topic-link this}}}

                {{#if unread}}
                  <a href="{{unbound lastUnreadUrl}}" class='badge unread badge-notification' title='{{i18n topic.unread_posts count="unread"}}'>{{unbound unread}}</a>
                {{/if}}
                {{#if new_posts}}
                  <a href="{{unbound lastUnreadUrl}}" class='badge new-posts badge-notification' title='{{i18n topic.new_posts count="new_posts"}}'>{{unbound new_posts}}</a>
                {{/if}}
                {{#if unseen}}
                  <a href="{{unbound lastUnreadUrl}}" class='badge new-posts badge-notification' title='{{i18n topic.new}}'><i class='fa fa-asterisk'></i></a>
                {{/if}}

                {{#if hasExcerpt}}
                  <div class="topic-excerpt">
                    {{{excerpt}}}
                    {{#if excerptTruncated}}
                      {{#unless canClearPin}}<a href="{{url}}">{{i18n read_more}}</a>{{/unless}}
                    {{/if}}
                    {{#if canClearPin}}
                      <a href="#" {{action clearPin this}} title="{{unbound i18n topic.clear_pin.help}}">{{i18n topic.clear_pin.title}}</a>
                    {{/if}}
                  </div>
                {{/if}}
              </div>
            </td>
            <td class='num posts'><span class='badge-posts'>{{number posts_count}}</span></td>
            <td class='num age'><span class="{{cold-age-class created_at}}" title='{{raw-date created_at}}'>{{{age created_at}}}</span></td>
          </tr>
        {{/each}}

        {{#if subcategories}}
          <tr>
            <td>
              <div class='subcategories'>
                {{#each subcategory in subcategories}}
                  {{category-link subcategory showParent=true}}
                {{/each}}
              </div>
            </td>
          </tr>
        {{/if}}

      </table>
      <footer class="clearfix">
        <figure title="{{i18n year_desc}}">{{number topics_year}} <figcaption>{{i18n category.this_year}}</figcaption></figure>
        <figure title="{{i18n month_desc}}">{{number topics_month}} <figcaption>{{i18n month}}</figcaption></figure>
        <figure title="{{i18n week_desc}}">{{number topics_week}} <figcaption>{{i18n week}}</figcaption></figure>

        {{#if controller.canEdit}}
          <a href='#' {{action editCategory this}} class='btn btn-small'>{{i18n category.edit}}</a>
        {{/if}}

        {{#if moreTopics}}
          <a href='/category/{{unbound slug}}' class='btn btn-small'>{{i18n category.more_posts posts="topic_count"}}</a>
        {{/if}}
      </footer>
    </div>
  {{/each}}
{{/if}}
